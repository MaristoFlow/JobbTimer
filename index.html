<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Nedräkning</title>
<style>
:root {
  --röd:#e63946;--orange:#ff9f1c;--blå:#0077b6;--ljusblå:#00b4d8;
  --gul:#ffd60a;--grön:#52b788;--silver:#bfc0c0;--guld:#ffd700;
  --bg:#0b0c10;--fg:#f4f4f5;--panel:#16171b;--accent:#3b82f6;
}
[data-theme="light"]{
  --bg:#f7f8fa;--fg:#0c0c0d;--panel:#fff;--accent:#2563eb;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:var(--bg);color:var(--fg);font-family:"Inter",system-ui,sans-serif;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:100vh;gap:2rem;transition:background .3s,color .3s;
}
h1{font-weight:700;font-size:2rem}
.timer{
  font-size:5rem;font-weight:800;text-align:center;
  padding:40px 80px;border-radius:24px;
  transition:background .4s ease,color .4s ease;
}
.controls{
  display:flex;flex-direction:column;align-items:center;gap:0.8rem;
  background:var(--panel);padding:1.5rem 2rem;border-radius:20px;
  box-shadow:0 0 25px rgba(0,0,0,.3);
}
.row{display:flex;gap:1rem;flex-wrap:wrap;justify-content:center}
input[type="time"]{
  background:transparent;border:1px solid #666;color:var(--fg);
  font-size:1rem;padding:0.5rem 0.8rem;border-radius:10px;width:120px;
}
button{
  background:#222;color:#fff;border:none;border-radius:10px;
  padding:0.6rem 1.2rem;font-weight:600;font-size:1rem;cursor:pointer;
  transition:.2s;
}
[data-theme="light"] button{background:#eee;color:#000}
button:hover{opacity:.85}
.progress{
  width:min(80vw,400px);height:10px;background:#2b2b2b;border-radius:999px;
  overflow:hidden;
}
[data-theme="light"] .progress{background:#d1d5db}
.progress span{
  display:block;height:100%;width:0%;background:var(--accent);
  border-radius:999px;transition:width .4s;
}
.theme-toggle{
  position:fixed;top:1rem;right:1rem;background:var(--panel);
  color:var(--fg);border:1px solid #444;padding:0.4rem 1rem;
  border-radius:999px;font-weight:600;cursor:pointer;
}
[data-theme="light"] .theme-toggle{border:1px solid #ccc}
@media(max-width:600px){
  .timer{font-size:3.4rem;padding:30px 40px;}
}
</style>
</head>
<body>

<button id="themeToggle" class="theme-toggle">Dark</button>

<h1>Nedräkning</h1>
<div class="timer" id="timer">--:--:--</div>
<div class="progress"><span id="bar"></span></div>

<div class="controls">
  <div class="row">
    <input type="time" id="startTime" value="08:00">
    <input type="time" id="endTime" value="17:00">
  </div>
  <div class="row">
    <button id="startBtn">Starta</button>
    <button id="nowBtn">Nu</button>
    <button id="stopBtn">Stop</button>
  </div>
</div>

<script>
const tEl=document.getElementById("timer");
const bar=document.getElementById("bar");
const startBtn=document.getElementById("startBtn");
const nowBtn=document.getElementById("nowBtn");
const stopBtn=document.getElementById("stopBtn");
const startInput=document.getElementById("startTime");
const endInput=document.getElementById("endTime");
const themeBtn=document.getElementById("themeToggle");
let timer=null,startTime=null,endTime=null,autoStart=false;

function fmt(ms){
  const h=Math.floor(ms/3600000),
        m=Math.floor((ms%3600000)/60000),
        s=Math.floor((ms%60000)/1000);
  return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}
function color(h){
  if(h>=8)return"var(--röd)";
  if(h>=6)return"var(--orange)";
  if(h>=4)return"var(--blå)";
  if(h>=2)return"var(--ljusblå)";
  if(h>=1)return"var(--gul)";
  if(h>=0.5)return"var(--grön)";
  if(h>=0.25)return"var(--silver)";
  return"var(--guld)";
}
function tick(){
  if(!startTime||!endTime){tEl.textContent="--:--:--";return;}
  const now=new Date(),total=endTime-startTime,rem=endTime-now;
  if(rem<=0){clearInterval(timer);tEl.textContent="KLAR!";tEl.style.background="var(--guld)";bar.style.width="100%";return;}
  const hrs=rem/3600000,prog=(1-rem/total)*100;
  tEl.textContent=fmt(rem);tEl.style.background=color(hrs);bar.style.width=prog+"%";
}
function startCountdown(){clearInterval(timer);tick();timer=setInterval(tick,1000);}
function setTimes(){
  const [sH,sM]=startInput.value.split(":").map(Number);
  const [eH,eM]=endInput.value.split(":").map(Number);
  const now=new Date();
  startTime=new Date(now.getFullYear(),now.getMonth(),now.getDate(),sH,sM);
  endTime=new Date(now.getFullYear(),now.getMonth(),now.getDate(),eH,eM);
}
startBtn.onclick=()=>{setTimes();if(endTime<=startTime)return alert("Sluttid måste vara senare.");autoStart=true;startCountdown();}
nowBtn.onclick=()=>{
  const [eH,eM]=endInput.value.split(":").map(Number);
  const now=new Date();
  startTime=now;
  endTime=new Date(now.getFullYear(),now.getMonth(),now.getDate(),eH,eM);
  if(endTime<=now)return alert("Sluttid måste vara senare än nu.");
  autoStart=true;startCountdown();
};
stopBtn.onclick=()=>{clearInterval(timer);autoStart=false;tEl.textContent="--:--:--";tEl.style.background="transparent";bar.style.width="0%";};
[startInput,endInput].forEach(inp=>inp.addEventListener("change",()=>{
  if(autoStart){setTimes();startCountdown();}
}));

/* Tema */
function setTheme(mode){
  document.documentElement.setAttribute("data-theme",mode);
  themeBtn.textContent = mode==="light" ? "Dark" : "Light";
  localStorage.setItem("theme-mode",mode);
}
themeBtn.onclick=()=>{
  const cur=document.documentElement.getAttribute("data-theme")||"dark";
  setTheme(cur==="dark"?"light":"dark");
};
(function init(){
  const saved=localStorage.getItem("theme-mode");
  setTheme(saved||"dark");
})();
</script>

</body>
</html>
